<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>如何优雅的使用RocketMQ | 孙道之 Tech</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/css/highlight.css">

  
  <meta name="description" content="RocketMQ 是一个 队列模型 的消息中间件，具有高性能、高可靠、高实时、分布式 的特点。它是一个采用 Java 语言开发的分布式的消息系统，由阿里巴巴团队开发，在 2016 年底贡献给 Apache，成为了 Apache 的一个顶级项目。 在阿里内部，RocketMQ 很好地服务了集团大大小小上千个应用，在每年的双十一当天，更有不可思议的万亿级消息通过 RocketMQ 流转。">
<meta property="og:type" content="article">
<meta property="og:title" content="如何优雅的使用RocketMQ">
<meta property="og:url" content="https://sundaozhi.tech/2022/05/02/springboot-%E5%A6%82%E4%BD%95%E4%BC%98%E9%9B%85%E7%9A%84%E4%BD%BF%E7%94%A8alibaba-rocketmq%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/index.html">
<meta property="og:site_name" content="孙道之 Tech">
<meta property="og:description" content="RocketMQ 是一个 队列模型 的消息中间件，具有高性能、高可靠、高实时、分布式 的特点。它是一个采用 Java 语言开发的分布式的消息系统，由阿里巴巴团队开发，在 2016 年底贡献给 Apache，成为了 Apache 的一个顶级项目。 在阿里内部，RocketMQ 很好地服务了集团大大小小上千个应用，在每年的双十一当天，更有不可思议的万亿级消息通过 RocketMQ 流转。">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2022-05-02T13:19:07.000Z">
<meta property="article:modified_time" content="2023-02-26T11:45:22.159Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="SpringBoot">
<meta property="article:tag" content="RocketMQ">
<meta property="article:tag" content="快速开始">
<meta name="twitter:card" content="summary"><meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="wrapper">
    <header id="header">
  <h1 id="title">
    <a href="/">孙道之 Tech</a>
  </h1>
  <nav>
    
    
      
      <a class="nav-link" href="/">Home</a>
    
      
        <span class="nav-spacer">×</span>
      
      <a class="nav-link" href="/archives">Archives</a>
    
    
  </nav>
</header>

    <div id="content">
      <article id="post-springboot-如何优雅的使用alibaba-rocketmq消息队列" class="article article-type-post" itemprop="blogPost" itemscope>
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h2 class="article-title" itemprop="headline name">
      如何优雅的使用RocketMQ
    </h2>
  


        <div class="article-meta">
          <time class="article-date" datetime="2022-05-02T13:19:07.000Z" itemprop="datePublished">May 2, 2022, 9:19 PM</time>

          
        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
      
        <p>RocketMQ 是一个 队列模型 的消息中间件，具有高性能、高可靠、高实时、分布式 的特点。它是一个采用 Java 语言开发的分布式的消息系统，由阿里巴巴团队开发，在 2016 年底贡献给 Apache，成为了 Apache 的一个顶级项目。 在阿里内部，RocketMQ 很好地服务了集团大大小小上千个应用，在每年的双十一当天，更有不可思议的万亿级消息通过 RocketMQ 流转。</p>
<span id="more"></span>

<p>废话不多说，想要了解 RocketMQ 历史的同学可以自己去搜寻资料。听完上面的介绍，你只要知道 RocketMQ 很快、很牛、而且经历过双十一的实践就行了！</p>
<h2 id="新建-springboot-项目"><a href="#新建-springboot-项目" class="headerlink" title="新建 springboot 项目"></a>新建 springboot 项目</h2><hr>
<p>新建一个 springboot 项目，rocketmq 使用 apache 封装的 jar</p>
<p>pom 文件如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.11.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>cn.chenbing.study<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>cloud-alibaba-rocketmq<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.rocketmq<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>rocketmq-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="创建配置管理类"><a href="#创建配置管理类" class="headerlink" title="创建配置管理类"></a>创建配置管理类</h2><hr>
<p>我们 nameserver 直接使用本地安装的就可以，topic 是 rocketmq 服务端默认就会创建的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RmqConfig</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Name Server 地址，因为是集群部署 所以有多个用 分号 隔开</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NAME_SERVER</span> <span class="operator">=</span> <span class="string">&quot;localhost:9876&quot;</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 主题名称 主题一般是服务器设置好 而不能在代码里去新建topic（ 如果没有创建好，生产者往该主题发送消息 会报找不到topic错误）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">TOPIC</span> <span class="operator">=</span> <span class="string">&quot;TestTopic&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Producer"><a href="#Producer" class="headerlink" title="Producer"></a>Producer</h2><hr>
<p>新建消息生产端 Producer，负责生产消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> org.apache.rocketmq.client.exception.MQClientException;</span><br><span class="line"><span class="keyword">import</span> org.apache.rocketmq.client.producer.DefaultMQProducer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Producer</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生产者组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">producerGroup</span> <span class="operator">=</span> <span class="string">&quot;test_producer&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> DefaultMQProducer producer;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Producer</span><span class="params">()</span> <span class="keyword">throws</span> MQClientException &#123;</span><br><span class="line">        producerInit().start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DefaultMQProducer <span class="title function_">producerInit</span><span class="params">()</span> &#123;</span><br><span class="line">        producer = <span class="keyword">new</span> <span class="title class_">DefaultMQProducer</span>(producerGroup);</span><br><span class="line">        <span class="comment">// 不开启 vip 通道 开通口端口会减 2</span></span><br><span class="line">        producer.setVipChannelEnabled(<span class="literal">false</span>);</span><br><span class="line">        <span class="comment">// 绑定 name server</span></span><br><span class="line">        producer.setNamesrvAddr(RmqConfig.NAME_SERVER);</span><br><span class="line">        <span class="keyword">return</span> producer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Consumer"><a href="#Consumer" class="headerlink" title="Consumer"></a>Consumer</h2><hr>
<p>建立消息消费端 Consumer，负责消费消息</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.rocketmq.client.consumer.DefaultMQPushConsumer;</span><br><span class="line"><span class="keyword">import</span> org.apache.rocketmq.client.consumer.listener.ConsumeConcurrentlyStatus;</span><br><span class="line"><span class="keyword">import</span> org.apache.rocketmq.client.consumer.listener.MessageListenerConcurrently;</span><br><span class="line"><span class="keyword">import</span> org.apache.rocketmq.client.exception.MQClientException;</span><br><span class="line"><span class="keyword">import</span> org.apache.rocketmq.common.consumer.ConsumeFromWhere;</span><br><span class="line"><span class="keyword">import</span> org.apache.rocketmq.common.message.Message;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.UnsupportedEncodingException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Consumer</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 消费者组</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">CONSUMER_GROUP</span> <span class="operator">=</span> <span class="string">&quot;test_consumer&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Consumer</span><span class="params">()</span> <span class="keyword">throws</span> MQClientException &#123;</span><br><span class="line">        consumerInit().start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> DefaultMQPushConsumer <span class="title function_">consumerInit</span><span class="params">()</span> <span class="keyword">throws</span> MQClientException &#123;</span><br><span class="line">        <span class="type">DefaultMQPushConsumer</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultMQPushConsumer</span>(CONSUMER_GROUP);</span><br><span class="line">        consumer.setNamesrvAddr(RmqConfig.NAME_SERVER);</span><br><span class="line">        <span class="comment">// 消费模式:一个新的订阅组第一次启动从队列的最后位置开始消费 后续再启动接着上次消费的进度开始消费</span></span><br><span class="line">        consumer.setConsumeFromWhere(ConsumeFromWhere.CONSUME_FROM_LAST_OFFSET);</span><br><span class="line">        <span class="comment">// 订阅主题和 标签（ * 代表所有标签)下信息</span></span><br><span class="line">        consumer.subscribe(RmqConfig.TOPIC, <span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// 注册消费的监听 并在此监听中消费信息, 并返回消费的状态信息</span></span><br><span class="line">        consumer.registerMessageListener((MessageListenerConcurrently) (msgs, context) -&gt; &#123;</span><br><span class="line">            <span class="comment">// msgs 中只收集同一个topic, 同一个 tag, 并且 key 相同的message</span></span><br><span class="line">            <span class="comment">// 会把不同的消息分别放置到不同的队列中</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (Message msg : msgs) &#123;</span><br><span class="line">                    <span class="comment">// 消费者获取消息 这里只输出 不做后面逻辑处理</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">body</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(msg.getBody(), <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">                    log.info(<span class="string">&quot;  &gt;&gt;&gt; [消费端] 获取消息主题 topic :: &#123;&#125;, 消费消息 body :: &#123;&#125; &quot;</span>, msg.getTopic(), body);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (UnsupportedEncodingException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span> ConsumeConcurrentlyStatus.RECONSUME_LATER;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> ConsumeConcurrentlyStatus.CONSUME_SUCCESS;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> consumer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试-Controller"><a href="#测试-Controller" class="headerlink" title="测试 Controller"></a>测试 Controller</h2><hr>
<p>创建对应 Controller 测试类，生产 100 条消息由消费者执行，最终把返回信息进行打印</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.rocketmq.client.producer.SendResult;</span><br><span class="line"><span class="keyword">import</span> org.apache.rocketmq.common.message.Message;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Controller</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Producer producer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/rocketmq/send&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">callback</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="comment">// 创建生产信息</span></span><br><span class="line">            <span class="type">Message</span> <span class="variable">message</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Message</span>(RmqConfig.TOPIC, <span class="string">&quot;testTag&quot;</span>, (String.format(<span class="string">&quot;[生产者] 发送第 【%d】 次 mq 消息&quot;</span>, i)).getBytes());</span><br><span class="line">            <span class="comment">// 发送消息</span></span><br><span class="line">            <span class="type">SendResult</span> <span class="variable">sendResult</span> <span class="operator">=</span> producer.getProducer().send(message);</span><br><span class="line">            log.info(<span class="string">&quot;  &gt;&gt;&gt; [生产者] 发送消息返回对象 :: &#123;&#125;&quot;</span>, sendResult);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;执行成功&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>截取部分日志，输出打印如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.718</span>  INFO <span class="number">45296</span> --- [essageThread_11] c.m.study.cloudalibabarocketmq.Consumer  :   &gt;&gt;&gt; [消费端] 获取消息主题 topic :: TestTopic, 消费消息 body :: [生产者] 发送第 【<span class="number">90</span>】 次 mq 消息</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.720</span>  INFO <span class="number">45296</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">1</span>] c.m.s.cloudalibabarocketmq.Controller    :   &gt;&gt;&gt; [生产者] 发送消息返回对象 :: SendResult [sendStatus=SEND_OK, msgId=0A10000EB0F018B4AAC23BFAFDCD005B, offsetMsgId=C0A8010200002A9F000000000027CF47, messageQueue=MessageQueue [topic=TestTopic, brokerName=broker-a, queueId=<span class="number">0</span>], queueOffset=<span class="number">3060</span>]</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.721</span>  INFO <span class="number">45296</span> --- [essageThread_12] c.m.study.cloudalibabarocketmq.Consumer  :   &gt;&gt;&gt; [消费端] 获取消息主题 topic :: TestTopic, 消费消息 body :: [生产者] 发送第 【<span class="number">91</span>】 次 mq 消息</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.722</span>  INFO <span class="number">45296</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">1</span>] c.m.s.cloudalibabarocketmq.Controller    :   &gt;&gt;&gt; [生产者] 发送消息返回对象 :: SendResult [sendStatus=SEND_OK, msgId=0A10000EB0F018B4AAC23BFAFDD0005C, offsetMsgId=C0A8010200002A9F000000000027D018, messageQueue=MessageQueue [topic=TestTopic, brokerName=broker-a, queueId=<span class="number">1</span>], queueOffset=<span class="number">3062</span>]</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.724</span>  INFO <span class="number">45296</span> --- [essageThread_13] c.m.study.cloudalibabarocketmq.Consumer  :   &gt;&gt;&gt; [消费端] 获取消息主题 topic :: TestTopic, 消费消息 body :: [生产者] 发送第 【<span class="number">92</span>】 次 mq 消息</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.725</span>  INFO <span class="number">45296</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">1</span>] c.m.s.cloudalibabarocketmq.Controller    :   &gt;&gt;&gt; [生产者] 发送消息返回对象 :: SendResult [sendStatus=SEND_OK, msgId=0A10000EB0F018B4AAC23BFAFDD3005D, offsetMsgId=C0A8010200002A9F000000000027D0E9, messageQueue=MessageQueue [topic=TestTopic, brokerName=broker-a, queueId=<span class="number">2</span>], queueOffset=<span class="number">3059</span>]</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.726</span>  INFO <span class="number">45296</span> --- [essageThread_14] c.m.study.cloudalibabarocketmq.Consumer  :   &gt;&gt;&gt; [消费端] 获取消息主题 topic :: TestTopic, 消费消息 body :: [生产者] 发送第 【<span class="number">93</span>】 次 mq 消息</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.728</span>  INFO <span class="number">45296</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">1</span>] c.m.s.cloudalibabarocketmq.Controller    :   &gt;&gt;&gt; [生产者] 发送消息返回对象 :: SendResult [sendStatus=SEND_OK, msgId=0A10000EB0F018B4AAC23BFAFDD5005E, offsetMsgId=C0A8010200002A9F000000000027D1BA, messageQueue=MessageQueue [topic=TestTopic, brokerName=broker-a, queueId=<span class="number">3</span>], queueOffset=<span class="number">3058</span>]</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.729</span>  INFO <span class="number">45296</span> --- [essageThread_15] c.m.study.cloudalibabarocketmq.Consumer  :   &gt;&gt;&gt; [消费端] 获取消息主题 topic :: TestTopic, 消费消息 body :: [生产者] 发送第 【<span class="number">94</span>】 次 mq 消息</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.731</span>  INFO <span class="number">45296</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">1</span>] c.m.s.cloudalibabarocketmq.Controller    :   &gt;&gt;&gt; [生产者] 发送消息返回对象 :: SendResult [sendStatus=SEND_OK, msgId=0A10000EB0F018B4AAC23BFAFDD8005F, offsetMsgId=C0A8010200002A9F000000000027D28B, messageQueue=MessageQueue [topic=TestTopic, brokerName=broker-a, queueId=<span class="number">0</span>], queueOffset=<span class="number">3061</span>]</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.732</span>  INFO <span class="number">45296</span> --- [essageThread_16] c.m.study.cloudalibabarocketmq.Consumer  :   &gt;&gt;&gt; [消费端] 获取消息主题 topic :: TestTopic, 消费消息 body :: [生产者] 发送第 【<span class="number">95</span>】 次 mq 消息</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.734</span>  INFO <span class="number">45296</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">1</span>] c.m.s.cloudalibabarocketmq.Controller    :   &gt;&gt;&gt; [生产者] 发送消息返回对象 :: SendResult [sendStatus=SEND_OK, msgId=0A10000EB0F018B4AAC23BFAFDDB0060, offsetMsgId=C0A8010200002A9F000000000027D35C, messageQueue=MessageQueue [topic=TestTopic, brokerName=broker-a, queueId=<span class="number">1</span>], queueOffset=<span class="number">3063</span>]</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.735</span>  INFO <span class="number">45296</span> --- [essageThread_17] c.m.study.cloudalibabarocketmq.Consumer  :   &gt;&gt;&gt; [消费端] 获取消息主题 topic :: TestTopic, 消费消息 body :: [生产者] 发送第 【<span class="number">96</span>】 次 mq 消息</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.737</span>  INFO <span class="number">45296</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">1</span>] c.m.s.cloudalibabarocketmq.Controller    :   &gt;&gt;&gt; [生产者] 发送消息返回对象 :: SendResult [sendStatus=SEND_OK, msgId=0A10000EB0F018B4AAC23BFAFDDE0061, offsetMsgId=C0A8010200002A9F000000000027D42D, messageQueue=MessageQueue [topic=TestTopic, brokerName=broker-a, queueId=<span class="number">2</span>], queueOffset=<span class="number">3060</span>]</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.738</span>  INFO <span class="number">45296</span> --- [essageThread_18] c.m.study.cloudalibabarocketmq.Consumer  :   &gt;&gt;&gt; [消费端] 获取消息主题 topic :: TestTopic, 消费消息 body :: [生产者] 发送第 【<span class="number">97</span>】 次 mq 消息</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.740</span>  INFO <span class="number">45296</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">1</span>] c.m.s.cloudalibabarocketmq.Controller    :   &gt;&gt;&gt; [生产者] 发送消息返回对象 :: SendResult [sendStatus=SEND_OK, msgId=0A10000EB0F018B4AAC23BFAFDE10062, offsetMsgId=C0A8010200002A9F000000000027D4FE, messageQueue=MessageQueue [topic=TestTopic, brokerName=broker-a, queueId=<span class="number">3</span>], queueOffset=<span class="number">3059</span>]</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.741</span>  INFO <span class="number">45296</span> --- [essageThread_19] c.m.study.cloudalibabarocketmq.Consumer  :   &gt;&gt;&gt; [消费端] 获取消息主题 topic :: TestTopic, 消费消息 body :: [生产者] 发送第 【<span class="number">98</span>】 次 mq 消息</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.742</span>  INFO <span class="number">45296</span> --- [nio-<span class="number">8080</span>-exec-<span class="number">1</span>] c.m.s.cloudalibabarocketmq.Controller    :   &gt;&gt;&gt; [生产者] 发送消息返回对象 :: SendResult [sendStatus=SEND_OK, msgId=0A10000EB0F018B4AAC23BFAFDE40063, offsetMsgId=C0A8010200002A9F000000000027D5CF, messageQueue=MessageQueue [topic=TestTopic, brokerName=broker-a, queueId=<span class="number">0</span>], queueOffset=<span class="number">3062</span>]</span><br><span class="line"><span class="number">2020</span>-<span class="number">12</span>-<span class="number">12</span> <span class="number">15</span>:<span class="number">31</span>:<span class="number">44.745</span>  INFO <span class="number">45296</span> --- [essageThread_20] c.m.study.cloudalibabarocketmq.Consumer  :   &gt;&gt;&gt; [消费端] 获取消息主题 topic :: TestTopic, 消费消息 body :: [生产者] 发送第 【<span class="number">99</span>】 次 mq 消息</span><br></pre></td></tr></table></figure>

<p>根据文章这么一套走下来，可以说是玩过 rocketmq 了，后面就需要更深入去了解 rocketmq 特性以及具体使用了</p>

      
    </div>
    
    
    <div class="article-category">
      
        <b>Categories:</b>
        <a class="article-category-link" href="/categories/RocketMQ/">RocketMQ</a>
      
      
        <br/>
      
      
        <b>Tags:</b>
        <a class="article-tag-none-link" href="/tags/RocketMQ/" rel="tag">RocketMQ</a>, <a class="article-tag-none-link" href="/tags/SpringBoot/" rel="tag">SpringBoot</a>, <a class="article-tag-none-link" href="/tags/%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/" rel="tag">快速开始</a>
      
    </div>
    
    
  </div>
</article>

  
<nav id="article-nav" class="article-nav">
  
    <a href="/2022/06/02/%E7%BA%BF%E4%B8%8AFastThrow/" id="article-nav-newer" class="article-nav-link-wrap newer">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          线上故障无报错信息记录
        
      </div>
    </a>
  
  
    <a href="/2022/04/03/python-switch%E5%A4%9A%E5%88%86%E6%94%AF%E9%80%89%E6%8B%A9%E7%9A%84%E5%AE%9E%E7%8E%B0/" id="article-nav-older" class="article-nav-link-wrap older">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">
        
          Python多分支选择的实现
        
      </div>
    </a>
  
</nav>






    </div>
  </div>
  




<div id="settings-container">
  <div id="dark-mode">dark</div>
  <div id="sans-font">sans</div>
</div>
<script type="text/javascript">
let d=document,r=d.documentElement.style,f=r.setProperty.bind(r),l=localStorage,s=l.getItem('s')||(window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches),n=l.getItem('n'),m=d.getElementById("dark-mode"),b=()=>{f('--bg-color','#fafafa');f('--code-bg-color','#f4f4f4');f('--text-color','#212121');f('--secondary-color','#808080');f('--tertiary-color','#b0b0b0');f('--link-color','#b5c8cf');f('--link-hover-color','#618794');f('--link-bg-color','#dae4e7');f('--selection-color','#dae4e7');m.innerHTML="dark"},c=()=>{f('--bg-color','#212121');f('--code-bg-color','#292929');f('--text-color','#fff');f('--secondary-color','#c0c0c0');f('--tertiary-color','#6e6e6e');f('--link-color','#4d6b75');f('--link-hover-color','#96b1bb');f('--link-bg-color','#5d828e');f('--selection-color','#acc1c9');m.innerHTML="light"},o=d.getElementById("sans-font"),e=()=>{f('--body-stack','"Lora", "Georgia", "Times New Roman", serif');o.innerHTML="sans"},g=()=>{f('--body-stack','"Lato", "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", "Verdana", sans-serif');o.innerHTML="serif"};m.onclick=()=>{if(s==2){s=1;l.setItem('s',s);c()}else{s=2;l.setItem('s',s);b()}};o.onclick=()=>{if(n==2){n=1;l.setItem('n',n);g()}else{n=2;l.setItem('n',n);e()}};if(!s){s=2;l.setItem('s',2)};if(s==1){c()};if(!n){n=2;l.setItem('n',2)};if(n==1){g()};
</script>




</body>
</html>
